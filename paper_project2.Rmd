---
title: "exploratory"
author: "Dylan Sun"
date: "2/2/2017"
output: pdf_document
---

### load packges
```{r, message=FALSE, warning=FALSE}
library(data.table)
library(readxl)
```

### load data3
```{r, message=FALSE, warning=FALSE, results='hide'}
full <- read_excel("~/Downloads/Updated DATAforBIOSTAT699.xls")
full <- data.table(full)
pain <- full[, .(pid, initialsite, condition, grpnbr, numsessions, therapysite, AGE, yearfmonset, yearfmdiagnosed, sex, bmi, ethnic, race, highesteduc, relationstatus, numberhousehold, numberchildren, currentemployment, hhincome, healthinsurance, tptotal, acr_fmness, CMSI_Total, BPI_PainSeverity_V2, BPI_PainSeverity_V3, BPI_PainSeverity_V4)]
```

## Study Aims
Primary Aim # 1: Main effects of the interventions vs. control.  To test the hypothesis that both EET and CBT will lead to greater improvements in outcomes (pain, mood, disability, fatigue, sleep, positive affect and life satisfaction, and cognitive functioning) over a 1-year follow-up than the control condition. 

Secondary Aim # 1: Differential outcome efficacy of interventions.  To explore the hypotheses that EET leads to greater improvement in depression and anxiety than does CBT, whereas CBT leads to greater improvement in physical functioning and activity than does EET.

## Methods
This dataset comes from a two-site, three-arm, allegiance-controlled randomized clinical trial. The dataset contains 230 individual subjects, with 94$\%$ females and 6$\%$ males. 

Subjects were randomized to three different treatments. The outcome variable, pain, was measured at baseline, immediately post-treatment, and six months post-treatment. 

Because this study was a randomized trial, we look at the different groups to see if the randomization was successful in creating evenly distributed groups. After showing that the groups are sufficiently similar, we can then compare the groups outcomes directly, without controlling for other factors, as we can then assume that they are equal.

### Description of Issues with data
1. There were 216 female subjects and only 14 male subjects, representing 94$\%$ and 6$\%$, respectively. Due to this gender imbalance in the study design, we cannot make any conclusive statements about men. 
2. Race imbalance; race 4 is overrepresented at WSU locations.
```{r}
table(pain[,.(therapysite, race)])
chisq.test(table(pain[,.(therapysite, race)]))
```
3. Unreliability of self-reported pain measures; 10 is described as "pain as bad as you can imagine," and yet pops up relatively often. 
4. Some missing data from patient drop-out.


### Check normality of outcome for t-tests (not that important)
```{r}
hist(pain[condition == "EDU", (BPI_PainSeverity_V2)])
hist(pain[condition == "CBT", (BPI_PainSeverity_V2)])
hist(pain[condition == "EET", (BPI_PainSeverity_V2)])
```


## Modeling

### Comparing treatment groups to control groups
```{r}
t.test(pain[condition == "EDU", .(BPI_PainSeverity_V2)], pain[condition == "CBT", .(BPI_PainSeverity_V2)])
t.test(pain[condition == "EDU", .(BPI_PainSeverity_V2)], pain[condition == "EET", .(BPI_PainSeverity_V2)])

t.test(pain[condition == "EDU", .(BPI_PainSeverity_V3)], pain[condition == "CBT", .(BPI_PainSeverity_V3)])
t.test(pain[condition == "EDU", .(BPI_PainSeverity_V3)], pain[condition == "EET", .(BPI_PainSeverity_V3)])


t.test(pain[condition == "EDU", .(BPI_PainSeverity_V4)], pain[condition == "CBT", .(BPI_PainSeverity_V4)])
t.test(pain[condition == "EDU", .(BPI_PainSeverity_V4)], pain[condition == "EET", .(BPI_PainSeverity_V4)])

```
T-tests comparing the difference in mean pain at baseline found no difference between EDU and EET, and no difference between EDU and CBT. 

T-tests comparing the difference in mean pain immediately post-treatment found a significant difference between EDU and EET, and a significant difference between EDU and CBT. 

T-tests comparing the difference in mean pain six months post-treatment found no difference between EDU and EET, and no difference between EDU and CBT. 

### Effect of treatment over time
```{r}
t.test(pain[condition == "EDU", .(BPI_PainSeverity_V2)], pain[condition == "EDU", .(BPI_PainSeverity_V3)])
t.test(pain[condition == "EDU", .(BPI_PainSeverity_V3)], pain[condition == "EDU", .(BPI_PainSeverity_V4)])
t.test(pain[condition == "EDU", .(BPI_PainSeverity_V2)], pain[condition == "EDU", .(BPI_PainSeverity_V4)])
```



